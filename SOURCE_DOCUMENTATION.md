**Project:** E-BHW Connect (e-bhm_connect)

Short, focused source-code documentation for student developers.

---

**Purpose**
- A small PHP web application for Barangay Bacong health workflows: admin dashboard, BHW (Barangay Health Worker) management, patient portal, chatbot (Gabby), and simple reports (PDF).

**Tech Stack (concise)**
- PHP 8.0 (procedural)
- MySQL (accessed via PDO)
- Frontend: Bootstrap 5, Chart.js, SweetAlert2
- Chatbot: Server-side proxy to a generative LLM (Gemini) via REST
- PDF: FPDF library (bundled in `lib/fpdf`)
- Hosting/dev: XAMPP (Apache + PHP + MySQL) recommended locally

---

**High-level Architecture**
- Single entry router: `index.php` (maps `?page=` and `?action=` to whitelisted pages/actions).
- Pages: `pages/` folder — view templates for public, portal, admin sections.
- Actions: `actions/` folder — backend handlers for form submissions, API proxy endpoints, report generation.
- Includes: `includes/` — headers/footers and shared UI (auth guards live here).
- Config: `config/config.php` and `config/database.php` — database and API key settings (keep out of VCS).
- Assets: `assets/` — CSS, JS, images. Admin CSS in `assets/css/admin.css`.
- Libraries: `lib/` contains FPDF and any bundled third-party libraries.

---

Key Files & Responsibilities (quick map)
- `index.php` — router; validates allowed pages/actions and includes them.
- `config/config.php` — site `BASE_URL`, `GEMINI_API_KEY` (sensitive), and other constants.
- `config/database.php` — creates the PDO `$pdo` connection used across actions/pages.
- `includes/header_*.php`, `includes/footer_*.php` — layout wrappers for public/portal/admin.
- `pages/admin/*.php` — admin UI (dashboard, patients, inventory, reports).
- `pages/portal/*.php` — patient portal screens (chat, dashboard, my records).
- `pages/public/*.php` — public site pages (home, contact, announcements).
- `actions/*.php` — server-side handlers. Examples:
  - `actions/register_bhw_action.php` — register a new BHW (triggered via router `?action=register-bhw`).
  - `actions/chatbot_api.php` — public chatbot endpoint proxy to LLM.
  - `actions/chatbot_portal_api.php` — portal chatbot endpoint (persists chat history).
  - `actions/report_*.php` — generate PDF reports using FPDF.
- `assets/js/chatbot.js`, `assets/js/chatbot_portal.js` — client-side chat UI logic.

---

Routing & Conventions (must-know)
- All form submissions should post to the router using `BASE_URL` and an `action` parameter, e.g.: `<form action="<?php echo BASE_URL; ?>?action=register-bhw" method="POST">`.
- `index.php` maintains `$allowedPages` and `$allowedActions` whitelists — add new pages/actions there to register them.
- Pages are included; actions are executed from `actions/` when routed.

Auth & Sessions
- Two main user types: BHW (admin-like) and Patient (portal). Session keys used commonly:
  - BHW: `$_SESSION['bhw_id']`, `$_SESSION['bhw_full_name']`
  - Patient: `$_SESSION['patient_id']`, `$_SESSION['patient_user_id']`, `$_SESSION['patient_full_name']`
- Use `includes/auth_bhw.php` and `includes/auth_patient.php` for access control.

Database Notes
- Database connection available in `$pdo` from `config/database.php` (PDO, prepared statements).
- Common tables: `bhw_users`, `patients`, `patient_health_records`, `chatbot_history`, `medication_inventory`, `health_visits`.

Chatbot Integration
- Chat endpoints are proxied server-side to avoid exposing API keys.
- `actions/chatbot_api.php` and `actions/chatbot_portal_api.php` prepare prompts with barangay-specific context and call the LLM via cURL.
- Client expects JSON `{ message: '...' }` and receives `{ reply: '...' }`.
- Chat UI renders Markdown for bot replies using `marked.js` (frontend library included via CDN).

PDF Reports
- Generated by actions using FPDF in `lib/fpdf/` (examples: `actions/report_bhw_record.php`, `actions/report_patient_record.php`).
- Reports are streamed as PDF responses for download.

Frontend Patterns
- Use `assets/css/chatbot.css` for chat styles and `assets/js/resizable.js` to allow resizing the chat window.
- Admin layout uses `assets/css/admin.css` with a fixed sidebar; sidebar becomes off-canvas on small screens.
- Use SweetAlert2 for user-friendly alerts and confirmations (included via CDN).

Security & Best Practices (short)
- Never commit `config/config.php` or API keys. Use `.gitignore` (already updated) and environment variables if possible.
- Sanitize and validate all user input on server-side before DB insertion.
- Use prepared statements (PDO) — current code follows this pattern.
- For production, re-enable SSL verification in cURL and secure API keys.

Local Setup (quick)
1. Install XAMPP (Apache + PHP 8.0 + MySQL).
2. Place the project in the webroot (e.g., `C:\xampp\htdocs\e-bhm_connect`).
3. Create a database and import `database.sql`.
4. Copy `config/config.php.example` → `config/config.php`, set `BASE_URL` and DB/LLM keys.
5. Ensure `config/config.php` is not added to git.
6. Open `http://localhost/e-bhm_connect/`.

Developer Tips (fast wins)
- When include() fails, prefer `require_once __DIR__ . '/../path/to/file.php'` — `__DIR__` is reliable and file-local.
- Use browser DevTools → Network to inspect POST target URL when forms misroute.
- Add a quick `tmp/test_dir.php` during debugging to print `__DIR__` and `getcwd()`.

Contributing & Extending
- Add new action: create `actions/your_action.php`, add `'your-action' => 'actions/your_action.php'` to `$allowedActions` in `index.php`.
- Add new page: create `pages/your_page.php`, add `'your-page' => ['file' => 'pages/your_page.php', 'secure' => false]` to `$allowedPages`.

Contact / Next Steps
- If you want, I can generate a smaller developer quick-start README (one-page) or add inline docblocks to key action files.

---

File created by tooling on behalf of the project team. Keep this file short and update as the codebase changes.
